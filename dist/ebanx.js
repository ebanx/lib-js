!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.EBANX=t():e.EBANX=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){var e={},t={country:"",mode:"test",publicKey:""};if(e.config=function(){return{isLive:function(){return"production"===t.mode},setPublishableKey:function(e){n.validator.config.validatePublishableKey(e,function(){t.publicKey=String(e)})},setCountry:function(e){n.validator.config.validateCountry(e),t.country=String(e)},setMode:function(e){n.validator.config.validateMode(e),t.mode=e},getMode:function(){return t.mode},getPublishableKey:function(){if(""===t.publicKey.trim())throw new n.errors.InvalidConfigurationError("Missing publishable key. You need set publishable key using the method EBANX.config.setPublishableKey.","publicKey");return t.publicKey},getCountry:function(){return t.country||(t.country="br"),t.country},getLocale:function(){var e={br:"pt_BR",mx:"es"};return e[n.config.getCountry()]}}}(),e.config.isLive()&&"https:"!==location.protocol)throw"EBANXInvalidConfigurationError: Your protocol needs to be https.";return e}();n.errors=function(){return{summary:{pt_BR:{"BP-DR-76":"País não informado.","BP-DR-77":"País não permitido.","BP-DR-75":"O número do cartão de crédito é inválido.","BP-DR-S-75":"A bandeira do cartão de crédito é inválida.","BP-DR-51":"Insira o nome que está impresso no cartão de crédito.","BP-DR-55":"O código do cartão de crédito é inválido.","BP-DR-57":"A data do cartão de crédito deve estar no formato mes/ano, por exemplo, 12/2020.","BP-DR-M-57":"O mês data do cartão de crédito é inválido.","BP-DR-Y-57":"O ano data do cartão de crédito é inválido."},es:{"BP-DR-76":"País não informado.","BP-DR-77":"País não permitido.","BP-DR-75":"El número de tarjeta de crédito es inválido.","BP-DR-S-75":"El bandera de tarjeta de crédito es inválido.","BP-DR-51":"Por favor, introduce el nombre como está en tu tarjeta de crédito.","BP-DR-55":"El código de tarjeta de crédito es inválido.","BP-DR-57":"Por favor, escribe la fecha en el formato MM/AAAA.","BP-DR-M-57":"El mes de tarjeta de crédito es inválido.","BP-DR-Y-57":"El año de tarjeta de crédito es inválido."}},InvalidValueFieldError:function(e,t){this.message=n.errors.summary[n.config.getLocale()][e]||e,this.field=t,this.name="InvalidValueFieldError"},InvalidConfigurationError:function(e,t){this.message=n.errors.summary[n.config.getLocale()][e]||e,this.invalidConfiguration=t,this.name="InvalidConfigurationError"}}}(),n.validator=function(){return{config:{validatePublishableKey:function(e,t){var r=n.utils.api.resources.validPublicIntegrationKey();n.http.ajax.request({url:r.url,method:r.method,data:{public_integration_key:e}}).always(function(e){t(e)})},validateCountry:function(e){if(n.utils.availableCountries.indexOf(e)===-1)throw new n.errors.InvalidValueFieldError("BP-DR-77","country")},validateMode:function(e){if(null===e.match(/^(test|production)$/))throw new n.errors.InvalidConfigurationError('Invalid mode, please, use "test" or "production" as test mode.',"mode")}},card:{validateNumber:function(e){var t=/^3[47][0-9]{13}$|^50[0-9]{14,17}$|^(636368|438935|504175|451416|636297|5067|4576|4011|50904|50905|50906)|^3(?:0[0-5]|[68][0-9])[0-9]{11}$|^6(?:011|5[0-9]{2})[0-9]{12}$|^(38|60)[0-9]{11,17}$|^5[1-5][0-9]{14}$|^4[0-9]{12}(?:[0-9]{3})?$/;if(!t.test(e)||!this.luhnAlgCheck(String(e)))throw new n.errors.InvalidValueFieldError("BP-DR-75","card_number")},validateName:function(e){if("string"!=typeof e||0===e.length||null!==e.match(/[0-9]+/))throw new n.errors.InvalidValueFieldError("BP-DR-51","card_name")},luhnAlgCheck:function(e){var t,r,n,o;for(n=+e[t=e.length-1],o=0;t--;)r=+e[t],n+=++o%2?2*r%10+(r>4):r;return n%10===0},validateCvv:function(e){var t=new RegExp("^[0-9]{3,4}$");if("string"===!("undefined"==typeof e?"undefined":r(e))||!e instanceof String||!e.toString().match(t))throw new n.errors.InvalidValueFieldError("BP-DR-55","card_cvv")},validateDueDate:function(e){var t=(e+"").split("/");if(t={now:new Date,year:t[1],month:t[0]},/^\d+$/.test(t.month)!==!0||parseInt(t.month,10)<=12!=!0)throw new n.errors.InvalidValueFieldError("BP-DR-M-57","card_due_date");if(!/^\d+$/.test(t.year))throw new n.errors.InvalidValueFieldError("BP-DR-Y-57","card_due_date");if(t.expiration=new Date(t.year,t.month),t.expiration.setMonth(t.expiration.getMonth()-1),t.expiration.setMonth(t.expiration.getMonth()+1,1),t.expiration>t.now!=!0)throw new n.errors.InvalidValueFieldError("BP-DR-57","card_due_date")},validate:function(e){this.validateName(e.card_name),this.validateNumber(e.card_number),this.validateDueDate(e.card_due_date),this.validateCvv(e.card_cvv)}}}}(),n.tokenize=function(){return{card:{token:function(e,t,r){var o=n.utils.api.resources.createToken();n.http.ajax.request({url:o.url,method:o.method,json:!0,data:{request_body:JSON.stringify({public_integration_key:n.config.getPublishableKey(),payment_type_code:n.utils.creditCardScheme(e.card_number),country:n.config.getCountry(),card:e})}}).always(function(e){return"ERROR"!==e.status&&"token"in e?t(e):r(e)})}}}}(),n.utils=function(){var e={api:{path:function(){return n.config.isLive()?"https://api.ebanx.com/":"https://sandbox.ebanx.com/"}},availableCountries:["br","mx"].join(", "),creditCardScheme:function(e){n.validator.card.validateNumber(e);var t={amex:/^3[47][0-9]{13}$/,aura:/^50[0-9]{14,17}$/,elo:/^(636368|438935|504175|451416|636297|5067|4576|4011|50904|50905|50906)/,diners:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,discover:/^6(?:011|5[0-9]{2})[0-9]{12}$/,hipercard:/^(38|60)[0-9]{11,17}$/,mastercard:/^5[1-5][0-9]{14}$/,visa:/^4[0-9]{12}(?:[0-9]{3})?$/};for(var r in t)if(t[r].test(e))return r;throw new n.errors.InvalidValueFieldError("BP-DR-S-75","card_number")}};return e.api.url=function(){return e.api.path()+"ws"},e.api.resources={createToken:function(){return{url:e.api.url()+"/token",method:"get"}},validPublicIntegrationKey:function(){return{url:e.api.url()+"/merchantIntegrationProperties/isValidPublicIntegrationKey",method:"get"}},fingerPrintResource:function(){return{url:e.api.path()+"fingerprint/",method:"get"}},fingerPrintProvidersResource:function(){return{url:e.api.path()+"fingerprint/provider",method:"post"}}},e}(),n.http=function(){return{normalize:{q:function(e,t){function n(e,t){var o=[];return t=t||[],Object.keys(e).forEach(function(i){if(e.hasOwnProperty(i)){var a=t.slice();a.push(i);var s=[];"object"==r(e[i])?s=n(e[i],a):s.push({path:a,val:e[i]}),s.forEach(function(e){return o.push(e)})}}),o}var o=n(e);o=o.map(function(e){if(1==e.path.length)e.path=e.path[0];else{var t=e.path[0],r=e.path.slice(1);e.path=t+"["+r.join("][")+"]"}return e});var i=o.map(function(e){return e.path+"="+e.val}).join("&");return t?encodeURIComponent(i):i}},ajax:{request:function(e){"string"==typeof e&&(e={url:e}),e.url=e.url||"",e.method=e.method||"get",e.data=e.data||{};var t={host:{},process:function(e){var t=this;return this.xhr=null,window.ActiveXObject?this.xhr=new window.ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(this.xhr=new XMLHttpRequest),this.xhr&&(this.xhr.onreadystatechange=function(){if(4==t.xhr.readyState){var r=t.xhr.responseText||"{}";e.json===!0&&"undefined"!=typeof JSON&&(r=JSON.parse(r)),t.alwaysCallback&&t.alwaysCallback.apply(t.host,[r,t.xhr])}}),this.xhr.open("GET",e.url+"?"+n.http.normalize.q(e.data),!0),setTimeout(function(){t.xhr.send()},20),this},always:function(e){return this.alwaysCallback=e,this}};return t.process(e)}},injectJS:function(e,t){var r=document.createElement("script");r.type="text/javascript",r.async=!0,r.onload=t,r.src=e,document.getElementsByTagName("head")[0].appendChild(r)}}}(),n.card=function(){var e={};return e.createToken=function(e,t){var r={data:{},error:{}},o=function(e){r.data=e,n.deviceFingerprint.setup(function(e){return r.data.deviceId=e,t(r)})},i=function(e){return r.error.err=e,t(r)};try{n.validator.card.validate(e),n.tokenize.card.token(e,o,i)}catch(e){r.error.err=e,t(r)}},e}(),n.deviceFingerprint=function(){var e={},t={ebanx_session_id:null,providerSessionList:[],providerPostPending:null};return t.providers={kount:{setup:function(e,r){this.build(e),r(t.ebanx_session_id)},build:function(e){var r=document,o=r.createElement("iframe");o.width=1,o.height=1,o.frameborder=0,o.scrolling="no",o.src=n.utils.api.path()+"fingerprint/kount?m="+e.merchant_id+"&s="+t.ebanx_session_id,o.style.border=0,o.style.position="absolute",o.style.top="-200px",o.style.left="-200px",r.getElementsByTagName("body")[0].appendChild(o)}},mercadopago:{setup:function(e,t){t(this._mpGetDeviceID())},_mpGuid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},_mpGetDeviceID:function(){var e=this._mpGuid(),t=function(e,t,r){var n,o,i,a,s=t||{},d=r||{};s.type="application/x-shockwave-flash",window.ActiveXObject?(s.classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",d.movie=e):s.data=e,o="<object";for(n in s)o+=" "+n+'="'+s[n]+'"';o+=">";for(n in d)o+='<param name="'+n+'" value="'+d[n]+'" />';return o+="</object>",i=document.createElement("div"),i.innerHTML=o,a=i.firstChild,i.removeChild(a),a};(new Image).src="https://content.mercadopago.com/fp/clear.png?org_id=jk96mpy0&session_id="+e+"&m=1",(new Image).src="https://content.mercadopago.com/fp/clear.png?org_id=jk96mpy0&session_id="+e+"&m=2";var r=document.createElement("script");r.type="text/javascript",r.src="https://content.mercadopago.com/fp/check.js?org_id=jk96mpy0&session_id="+e,document.body.appendChild(r);var n=t("https://content.mercadopago.com/fp/fp.swf?org_id=jk96mpy0&session_id="+e,{id:"obj_id",width:1,height:1},{movie:"https://content.mercadopago.com/fp/fp.swf?org_id=jk96mpy0&session_id="+e});return document.body.appendChild(n),e}},openpay:{cdnUrl:"https://openpay.s3.amazonaws.com/",setup:function(e,t){this.loadJs(function(){OpenPay.setId(e.id),OpenPay.setApiKey(e.apiKey),OpenPay.setSandboxMode(e.sandboxMode),t(OpenPay.deviceData.setup())})},loadJs:function(e){var t=this,r=function(){n.http.injectJS(t.cdnUrl+"openpay.v1.min.js",function(){n.http.injectJS(t.cdnUrl+"openpay-data.v1.min.js",e)})};void 0===window.top.jQuery?n.http.injectJS("https://code.jquery.com/jquery-2.2.0.min.js",r):r()}}},t.getList=function(e){var t=n.utils.api.resources.fingerPrintResource();n.http.ajax.request({json:!0,url:t.url,method:t.method,data:{country:n.config.getCountry(),publicIntegrationKey:n.config.getPublishableKey()}}).always(function(t){e(t)})},t.saveProviderSessionList=function(e){t.providerPostPending&&clearTimeout(t.providerPostPending),t.providerSessionList.push(e),t.providerPostPending=setTimeout(t.postProviderSessionList,1e3)},t.postProviderSessionList=function(){var e=t.providerSessionList;t.providerSessionList=[],clearTimeout(t.providerPostPending),t.providerPostPending=null;var r=n.utils.api.resources.fingerPrintProvidersResource();n.http.ajax.request({url:r.url,method:r.method,data:{publicIntegrationKey:n.config.getPublishableKey(),ebanx_session_id:t.ebanx_session_id,providers:e}}).always(function(){})},e.setup=function(e){t.getList(function(r){r&&r.ebanx_session_id&&(t.ebanx_session_id=r.ebanx_session_id,e(r.ebanx_session_id),r.providers.forEach(function(e){t.providers[e.provider].setup(e.settings,function(r){t.saveProviderSessionList({provider:e.provider,session_id:r})})}))})},e}(),e.exports=n}])});